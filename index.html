<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Mi Amor - Animaci√≥n Completa Mejorada</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: 'Courier New', monospace;
      overflow: hidden;
      cursor: crosshair;
      touch-action: manipulation;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      position: relative;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle at center, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      color: #f14f8d;
    }

    /* Base Phase Styling */
    .phase {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      pointer-events: none;
      z-index: 1; /* Default z-index */
    }
    .phase.active {
      display: flex;
      opacity: 1;
      pointer-events: auto;
      z-index: 2; /* Active phase is on top */
    }
    .phase#phase1 { z-index: 4; } /* Phase 1 is on top initially */
    .phase#phase2 { z-index: 3; }
    .phase#phase3 { z-index: 2; }
    .phase#phase4 { z-index: 1; }

    button { padding:12px 24px; font-size:1.2rem; cursor:pointer; background:#ff4081; border:none; border-radius:4px; color:#fff; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.05); } }


    /* Stars */
    .star {
      position: absolute;
      border-radius: 50%;
      animation: twinkle 3s infinite ease-in-out;
      filter: blur(0.5px);
      pointer-events: none;
      z-index: 40;
    }
    .star.small {
      width: 2px;
      height: 2px;
      background: radial-gradient(circle, #ffffff 0%, rgba(255, 255, 255, 0.8) 50%, transparent 100%);
      box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
    }
    .star.medium {
      width: 3px;
      height: 3px;
      background: radial-gradient(circle, #ffd700 0%, rgba(255, 215, 0, 0.9) 50%, transparent 100%);
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.7);
    }
    .star.large {
      width: 4px;
      height: 4px;
      background: radial-gradient(circle, #87ceeb 0%, rgba(135, 206, 235, 0.9) 50%, transparent 100%);
      box-shadow: 0 0 8px rgba(135, 206, 235, 0.6);
    }
    @keyframes twinkle {
      0%, 100% {
        opacity: 0.3;
        transform: scale(1) rotate(0deg);
      }
      25% {
        opacity: 0.8;
        transform: scale(1.2) rotate(90deg);
      }
      50% {
        opacity: 1;
        transform: scale(1.5) rotate(180deg);
      }
      75% {
        opacity: 0.6;
        transform: scale(1.1) rotate(270deg);
      }
    }

    /* Constellation lines */
    .constellation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 45;
    }
    .constellation-line {
      position: absolute;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
      transform-origin: left center;
      animation: drawLine 4s ease-out forwards;
      opacity: 0;
      pointer-events: none;
    }
    @keyframes drawLine {
      0% {
        width: 0;
        opacity: 0;
      }
      50% {
        opacity: 0.6;
      }
      100% {
        width: 100%;
        opacity: 0.3;
      }
    }

    /* Sunflower container */
    .sunflower-container {
      position: fixed;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      filter: drop-shadow(0 0 20px rgba(251, 192, 45, 0.3));
      z-index: 50;
      width: 300px;
      height: 400px;
    }
    @media (max-width: 768px) {
      .sunflower-container {
        width: 250px;
        height: 320px;
      }
    }

    /* Sunflower SVG animations */
    .sunflower-svg {
      width: 100%;
      height: 100%;
      overflow: visible;
      animation: gentleFloat 6s ease-in-out infinite;
      display: block;
    }
    @keyframes gentleFloat {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      33% { transform: translateY(-8px) rotate(1deg); }
      66% { transform: translateY(4px) rotate(-1deg); }
    }
    .petal path {
      fill: url(#petalGradient);
      opacity: 0;
      animation: bloom 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      filter: drop-shadow(0 2px 4px rgba(251, 192, 45, 0.3));
    }
    .petal-1 { animation-delay: 0.5s; }
    .petal-2 { animation-delay: 0.65s; }
    .petal-3 { animation-delay: 0.8s; }
    .petal-4 { animation-delay: 0.95s; }
    .petal-5 { animation-delay: 1.1s; }
    .petal-6 { animation-delay: 1.25s; }
    .petal-7 { animation-delay: 1.4s; }
    .petal-8 { animation-delay: 1.55s; }
    .petal-9 { animation-delay: 1.7s; }
    .petal-10 { animation-delay: 1.85s; }
    .petal-11 { animation-delay: 2s; }
    .petal-12 { animation-delay: 2.15s; }
    @keyframes bloom {
      0% {
        transform: scale(0) rotate(-45deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.2) rotate(-20deg);
        opacity: 0.8;
      }
      100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }
    .center {
      fill: url(#centerGradient);
      opacity: 0;
      animation: centerAppear 0.8s ease-out forwards;
      animation-delay: 2.5s;
      filter: drop-shadow(0 2px 6px rgba(93, 64, 55, 0.4));
    }
    @keyframes centerAppear {
      0% {
        opacity: 0;
        transform: scale(0) rotate(180deg);
      }
      70% {
        opacity: 0.9;
        transform: scale(1.3) rotate(90deg);
      }
      100% {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
      }
    /* Stem animation */
    .stem {
      fill: none;
      stroke: url(#stemGradient);
      stroke-width: 10;
      stroke-linecap: round;
      stroke-dasharray: 150;
      stroke-dashoffset: 150;
      animation: drawStem 2s ease-out forwards;
      animation-delay: 0.2s;
      filter: drop-shadow(0 2px 4px rgba(46, 125, 50, 0.3));
    }
    @keyframes drawStem {
      to {
        stroke-dashoffset: 0;
      }
    }
    /* Leaf animation */
    .leaf {
      fill: url(#leafGradient);
      opacity: 0;
      animation: leafGrow 0.8s ease-out forwards;
      filter: drop-shadow(0 1px 3px rgba(46, 125, 50, 0.3));
    }
    .leaf-1 { animation-delay: 1.5s; }
    .leaf-2 { animation-delay: 1.8s; }
    @keyframes leafGrow {
      0% {
        opacity: 0;
        transform: scale(0) rotate(-45deg);
      }
      100% {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
    }

    /* Magic particles */
    .magic-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: radial-gradient(circle, #ffd700 0%, rgba(255, 215, 0, 0.8) 70%, transparent 100%);
      border-radius: 50%;
      animation: magicFloat 4s ease-in-out infinite;
      opacity: 0;
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
      pointer-events: none;
      z-index: 55;
    }
    @keyframes magicFloat {
      0%, 100% {
        opacity: 0;
        transform: translateY(0) scale(0.5);
      }
      25% {
        opacity: 0.8;
        transform: translateY(-20px) scale(1);
      }
      50% {
        opacity: 1;
        transform: translateY(-40px) scale(1.2);
      }
      75% {
        opacity: 0.6;
        transform: translateY(-20px) scale(0.8);
      }
    }

    /* Magic button container */
    .magic-button-container {
      position: fixed;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      animation: buttonAppear 2s ease-out forwards;
      animation-delay: 5s;
      z-index: 100;
      width: max-content;
    }
    @keyframes buttonAppear {
      0% {
        opacity: 0;
        transform: translateX(-50%) translateY(50px) scale(0.3);
      }
      50% {
        opacity: 0.8;
        transform: translateX(-50%) translateY(-10px) scale(1.1);
      }
      100% {
        opacity: 1;
        transform: translateX(-50%) translateY(0) scale(1);
      }
    }

    /* Magic button style */
    .magic-button {
      position: relative;
      background: linear-gradient(135deg, #8A2BE2 0%, #BA55D3 50%, #8A2BE2 100%);
      border: 3px solid #00FFFF;
      border-radius: 8px;
      padding: 15px 30px;
      color: #FFF;
      font-family: 'Press Start 2P', 'Courier New', monospace;
      font-size: clamp(14px, 2.5vw, 18px);
      font-weight: bold;
      cursor: pointer;
      box-shadow:
        0 4px 10px rgba(138, 43, 226, 0.6),
        inset 0 2px 0 rgba(255, 255, 255, 0.4),
        inset 0 -2px 0 rgba(0, 0, 0, 0.2);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
      user-select: none;
    }
    .magic-button:hover {
      transform: translateY(-2px);
      box-shadow:
        0 6px 15px rgba(138, 43, 226, 0.8),
        inset 0 2px 0 rgba(255, 255, 255, 0.6),
        inset 0 -2px 0 rgba(0, 0, 0, 0.3);
      background: linear-gradient(135deg, #BA55D3 0%, #8A2BE2 50%, #BA55D3 100%);
    }
    .magic-button:active {
      transform: translateY(0);
      box-shadow:
        0 2px 5px rgba(138, 43, 226, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, #8A2BE2 0%, #BA55D3 50%, #8A2BE2 100%);
    }

    /* Button sparkles container */
    .button-sparkles {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      overflow: hidden;
      border-radius: 8px;
      z-index: 10;
    }
    .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: radial-gradient(circle, #fff 0%, rgba(255, 255, 255, 0.8) 70%, transparent 100%);
      border-radius: 50%;
      animation: sparkleMove 2s ease-in-out infinite;
      opacity: 0;
      filter: blur(0.5px);
      pointer-events: none;
    }
    @keyframes sparkleMove {
      0% {
        opacity: 0;
        transform: translateY(20px) scale(0.3);
      }
      50% {
        opacity: 1;
        transform: translateY(-10px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-30px) scale(0.3);
      }
    }

    /* Ripple effect */
    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      transform: scale(0);
      animation: rippleEffect 0.6s linear;
      pointer-events: none;
      z-index: 20;
    }
    @keyframes rippleEffect {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    .button-icon {
      display: inline-block;
      font-size: 1.2em;
      animation: iconPulse 2s ease-in-out infinite;
      user-select: none;
    }
    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    /* Phase 2 styles */
    #phase2 {
      background: radial-gradient(ellipse at center, #000 0%, #050008 80%);
      overflow: hidden;
      cursor: crosshair;
      user-select: none;
    }

    /* Stars background for phase 2 */
    #phase2 .star {
      background: white;
    }

    /* Floating words */
    .floating-word {
      position: absolute;
      font-weight: bold;
      font-size: clamp(16px, 2.5vw, 28px);
      color: var(--color);
      text-shadow:
        0 0 10px var(--color),
        0 0 20px var(--color),
        0 0 30px var(--color);
      user-select: none;
      pointer-events: none;
      animation: wordLifecycle 5s ease-in-out forwards;
      white-space: nowrap;
      z-index: 95;
    }
    @keyframes wordLifecycle {
      0% {
        transform: translateY(50px) scale(0.3);
        opacity: 0;
      }
      20% {
        transform: translateY(0px) scale(1);
        opacity: 1;
      }
      80% {
        transform: translateY(-20px) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-70px) scale(0.3);
        opacity: 0;
      }
    }

    /* Shapes */
    .shape {
      position: absolute;
      animation: floatShape 6s ease-in-out infinite;
      pointer-events: none;
      z-index: 95;
    }
    @keyframes floatShape {
      0%, 100% {transform: translateY(0) rotate(0deg);}
      50% {transform: translateY(-25px) rotate(10deg);}
    }

    /* Heart */
    .heart {
      width: 50px;
      height: 45px;
      position: relative;
    }
    .heart::before,
    .heart::after {
      content: '';
      width: 26px;
      height: 40px;
      position: absolute;
      left: 25px;
      top: 0;
      background: #ff1493;
      border-radius: 25px 25px 0 0;
      transform: rotate(-45deg);
      transform-origin: 0 100%;
      box-shadow:
        0 0 20px #ff1493,
        0 0 40px rgba(255,20,147,0.6),
        inset 0 0 10px rgba(255,255,255,0.3);
    }
    .heart::after {
      left: 0;
      transform: rotate(45deg);
      transform-origin: 100% 100%;
    }

    /* Star shape */
    .star-shape {
      width: 50px;
      height: 50px;
      position: relative;
      display: inline-block;
    }
    .star-shape::before {
      content: "‚òÖ";
      font-size: 50px;
      color: #ffd700;
      text-shadow:
        0 0 20px #ffd700,
        0 0 40px rgba(255,215,0,0.8),
        0 0 60px rgba(255,215,0,0.4);
      position: absolute;
      top: -5px;
      left: 0;
    }

    /* Flower */
    .flower {
      width: 45px;
      height: 45px;
      position: relative;
    }
    .flower::before {
      content: "üå∏";
      font-size: 45px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #da70d6) drop-shadow(0 0 30px rgba(218,112,214,0.8));
    }

    /* Butterfly */
    .butterfly {
      width: 40px;
      height: 40px;
      position: relative;
    }
    .butterfly::before {
      content: "ü¶ã";
      font-size: 40px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #00ffff) drop-shadow(0 0 30px rgba(0,255,255,0.8));
    }

    /* Rose */
    .rose {
      width: 40px;
      height: 40px;
      position: relative;
    }
    .rose::before {
      content: "üåπ";
      font-size: 40px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #ff6b35) drop-shadow(0 0 30px rgba(255,107,53,0.8));
    }

    /* Diamond */
    .diamond {
      width: 30px;
      height: 30px;
      position: relative;
    }
    .diamond::before {
      content: "üíé";
      font-size: 30px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #00ffff) drop-shadow(0 0 30px rgba(0,255,255,0.8));
    }

    /* Crown */
    .crown {
      width: 35px;
      height: 35px;
      position: relative;
    }
    .crown::before {
      content: "üëë";
      font-size: 35px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #ffd700) drop-shadow(0 0 30px rgba(255,215,0,0.8));
    }

    /* Ring */
    .ring {
      width: 30px;
      height: 30px;
      position: relative;
    }
    .ring::before {
      content: "üíç";
      font-size: 30px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #ff69b4) drop-shadow(0 0 30px rgba(255,105,180,0.8));
    }

    /* Kiss */
    .kiss {
      width: 30px;
      height: 30px;
      position: relative;
    }
    .kiss::before {
      content: "üíã";
      font-size: 30px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #ff1493) drop-shadow(0 0 30px rgba(255,20,147,0.8));
    }

    /* Cupid */
    .cupid {
      width: 35px;
      height: 35px;
      position: relative;
    }
    .cupid::before {
      content: "üíò";
      font-size: 35px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #ff69b4) drop-shadow(0 0 30px rgba(255,105,180,0.8));
    }

    /* Sparkles */
    .sparkles {
      width: 30px;
      height: 30px;
      position: relative;
    }
    .sparkles::before {
      content: "‚ú®";
      font-size: 30px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #ffd700) drop-shadow(0 0 30px rgba(255,215,0,0.8));
    }

    /* Moon */
    .moon {
      width: 30px;
      height: 30px;
      position: relative;
    }
    .moon::before {
      content: "üåô";
      font-size: 30px;
      position: absolute;
      top: 0;
      left: 0;
      filter: drop-shadow(0 0 15px #87ceeb) drop-shadow(0 0 30px rgba(135,206,235,0.8));
    }

    /* ===== FASE 3: ‚Äú¬°Eres mi universo!‚Äù ===== */
    #phase3 {
      background:#000;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      color:#fff;
      font-family: 'Segoe UI', sans-serif;
      position: relative; /* Needed for absolute positioning of aurora */
      overflow: hidden; /* Hide overflowing aurora parts */
    }
    #phase3 .text {
      font-size:3rem;
      animation: fadeInZoom 3s forwards; /* Updated animation here */
      opacity:0;
      text-shadow: 0 0 10px rgba(255,255,255,0.8), 0 0 20px rgba(255,255,255,0.6);
      position: relative;
      z-index: 10; /* Ensure text is above aurora */
    }
    /* New keyframes for combined fade in and zoom */
    @keyframes fadeInZoom {
      0% {
        opacity: 0;
        transform: scale(0.8);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Aurora effect for Phase 3 */
    .aurora {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 70%, rgba(0, 255, 255, 0.3) 0%, rgba(138, 43, 226, 0.3) 20%, transparent 80%);
      filter: blur(50px);
      animation: auroraGlow 8s ease-in-out infinite alternate;
      z-index: 5; /* Behind text */
    }

    @keyframes auroraGlow {
      0% {
        transform: scale(1) rotate(0deg);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.1) rotate(5deg);
        opacity: 1;
      }
      100% {
        transform: scale(1) rotate(0deg);
        opacity: 0.8;
      }
    }


    /* ===== FASE 4: Carta y sobre ===== */
    #phase4 {
      background:#111;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      color:#fff;
      font-family: 'Segoe UI', sans-serif;
      position: relative; /* Ensure proper stacking context */
    }
    #envelope {
      width:300px;
      height:200px;
      background:#eee;
      position:relative;
      clip-path: polygon(0 0, 100% 0, 100% 70%, 50% 100%, 0 70%);
      transform: scale(0);
      animation: appear 1s forwards 0.5s;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      z-index: 1; /* Envelope is behind letter */
    }
    #letter {
      position:absolute;
      top:50%;
      left:50%;
      transform: translate(-50%,-50%) scale(0);
      width:280px; /* Slightly wider */
      height:auto; /* Auto height to fit content */
      max-height: 80%; /* Max height for responsiveness */
      background:#fff;
      padding:25px; /* More padding */
      box-sizing:border-box;
      animation: appear 1s forwards 1.5s;
      color:#333;
      line-height: 1.6; /* Improved line spacing */
      text-align: left;
      font-family: 'Georgia', serif;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2), inset 0 0 10px rgba(0,0,0,0.05); /* Softer shadow */
      border-radius: 4px; /* Slight rounded corners for paper effect */
      overflow-y: auto; /* Enable scroll if content overflows */
      z-index: 2; /* Letter is above envelope */
    }
    #letter::-webkit-scrollbar {
        width: 8px;
    }
    #letter::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    #letter::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }
    #letter::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    @keyframes appear { to { transform: translate(-50%,-50%) scale(1); } }

    #cardText {
      opacity:0;
      animation: fadeIn 2s forwards 2.5s;
      font-size:1.2rem;
      margin-top:20px;
      text-align:center;
      max-width:80%;
      color:#fff;
      font-family: 'Segoe UI', sans-serif;
    }

    /* Typing effect for letter text */
    .typing-text {
      display: inline-block;
      overflow: hidden; /* Ensures the text is hidden until typed */
      white-space: pre-wrap; /* Allows line breaks in the message */
      border-right: .15em solid orange; /* The blinking cursor */
      animation:
        typing 4s steps(40, end) forwards,
        blink-caret .75s step-end infinite;
      animation-delay: 2s; /* Delay for typing effect after letter appears */
      width: 0; /* Start with no width to animate typing */
      opacity: 0; /* Start hidden */
    }

    @keyframes typing {
      from { width: 0; opacity: 0; }
      to { width: 100%; opacity: 1; }
    }

    @keyframes blink-caret {
      from, to { border-color: transparent }
      50% { border-color: orange; }
    }

    /* Styles for the Gemini API button */
    .gemini-button {
      position: relative;
      margin-top: 20px; /* Space from the letter */
      background: linear-gradient(135deg, #FF69B4 0%, #FF1493 50%, #FF69B4 100%); /* Pink gradient */
      border: 3px solid #00FFFF;
      border-radius: 8px;
      padding: 15px 30px;
      color: #FFF;
      font-family: 'Press Start 2P', 'Courier New', monospace;
      font-size: clamp(14px, 2.5vw, 18px);
      font-weight: bold;
      cursor: pointer;
      box-shadow:
        0 4px 10px rgba(255, 105, 180, 0.6),
        inset 0 2px 0 rgba(255, 255, 255, 0.4),
        inset 0 -2px 0 rgba(0, 0, 0, 0.2);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
      user-select: none;
      opacity: 0; /* Start hidden */
      animation: buttonAppear 2s forwards; /* Re-use buttonAppear for this button */
      animation-delay: 5s; /* Delay appearance after letter */
    }
    .gemini-button:hover {
      transform: translateY(-2px);
      box-shadow:
        0 6px 15px rgba(255, 105, 180, 0.8),
        inset 0 2px 0 rgba(255, 255, 255, 0.6),
        inset 0 -2px 0 rgba(0, 0, 0, 0.3);
      background: linear-gradient(135deg, #FF1493 0%, #FF69B4 50%, #FF1493 100%);
    }
    .gemini-button:active {
      transform: translateY(0);
      box-shadow:
        0 2px 5px rgba(255, 105, 180, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, #FF69B4 0%, #FF1493 50%, #FF69B4 100%);
    }

    /* Loading indicator for Gemini API button */
    .loading-indicator {
      display: none; /* Hidden by default */
      margin-top: 10px;
      font-size: 1rem;
      color: #fff;
      font-family: 'Press Start 2P', 'Courier New', monospace;
      animation: pulse 1s infinite alternate; /* Re-use pulse animation */
    }

  </style>
</head>
<body>
  <div id="phase1" class="phase active" aria-label="Fase 1 con girasol animado y estrellas">
    <div id="constellation" class="constellation" aria-hidden="true"></div>

    <div class="sunflower-container" aria-label="Ilustraci√≥n animada de un girasol amarillo brillante con p√©talos detallados y tallo verde, flotando suavemente en el centro de la pantalla">
      <svg class="sunflower-svg" viewBox="0 0 300 400" role="img" aria-labelledby="sunflowerTitle sunflowerDesc" xmlns="http://www.w3.org/2000/svg" >
        <title id="sunflowerTitle">Girasol animado</title>
        <desc id="sunflowerDesc">Un girasol amarillo con 12 p√©talos animados, centro marr√≥n y tallo verde con hojas, flotando suavemente</desc>
        <defs>
          <radialGradient id="petalGradient" cx="50%" cy="30%">
            <stop offset="0%" stop-color="#ffeb3b" stop-opacity="1" />
            <stop offset="50%" stop-color="#fbc02d" stop-opacity="1" />
            <stop offset="100%" stop-color="#f57f17" stop-opacity="1" />
          </radialGradient>
          <radialGradient id="centerGradient" cx="30%" cy="30%">
            <stop offset="0%" stop-color="#8d6e63" stop-opacity="1" />
            <stop offset="50%" stop-color="#5d4037" stop-opacity="1" />
            <stop offset="100%" stop-color="#3e2723" stop-opacity="1" />
          </radialGradient>
          <linearGradient id="stemGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" stop-color="#4caf50" stop-opacity="1" />
            <stop offset="50%" stop-color="#2e7d32" stop-opacity="1" />
            <stop offset="100%" stop-color="#1b5e20" stop-opacity="1" />
          </linearGradient>
          <linearGradient id="leafGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#66bb6a" stop-opacity="1" />
            <stop offset="100%" stop-color="#2e7d32" stop-opacity="1" />
          </linearGradient>
        </defs>

        <path class="stem" d="M150 200 C145 250, 155 300, 150 350" />

        <ellipse class="leaf leaf-1" cx="130" cy="280" rx="25" ry="15" transform="rotate(-30 130 280)" />
        <ellipse class="leaf leaf-2" cx="170" cy="320" rx="20" ry="12" transform="rotate(45 170 320)" />

        <g transform="translate(150, 180)">
          <g class="petal petal-1" transform="rotate(0)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-2" transform="rotate(30)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-3" transform="rotate(60)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-4" transform="rotate(90)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-5" transform="rotate(120)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-6" transform="rotate(150)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-7" transform="rotate(180)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-8" transform="rotate(210)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-9" transform="rotate(240)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-10" transform="rotate(270)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-11" transform="rotate(300)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>
          <g class="petal petal-12" transform="rotate(330)">
            <path d="M0,0 C15,-55 50,-55 50,0 C50,30 25,40 0,0 Z" />
          </g>

          <circle class="center" r="25" />

          <circle r="15" fill="#3e2723" opacity="0.6" style="animation: centerAppear 0.8s ease-out forwards; animation-delay: 2.8s;" />
        </g>
      </svg>
    </div>

    <div class="magic-button-container" role="region" aria-label="Bot√≥n para continuar la animaci√≥n">
      <button class="magic-button" id="nextPhaseBtn" aria-haspopup="true" aria-controls="phase2" aria-expanded="false" type="button">
        <div class="button-sparkles" id="buttonSparkles" aria-hidden="true"></div>
        <span class="button-icon" aria-hidden="true">üåª</span>
        Continuar la Magia
      </button>
    </div>
  </div>

  <div id="phase2" class="phase" aria-live="polite" aria-hidden="true"></div>

  <div id="phase3" class="phase" aria-hidden="true">
    <div class="aurora"></div> <div class="text">¬°Eres mi universo!</div>
  </div>

  <div id="phase4" class="phase" aria-hidden="true">
    <div id="envelope"></div>
    <div id="letter">
      <span id="typedMessage" class="typing-text"></span>
    </div>
    <!-- Removed the Gemini API button and loading indicator -->
  </div>

  <script>
    let currentPhase = 1;
    let sparkleInterval;
    let floatingWordsIntervals = []; // To store intervals for phase 2

    const phase1 = document.getElementById('phase1');
    const phase2 = document.getElementById('phase2');
    const phase3 = document.getElementById('phase3');
    const phase4 = document.getElementById('phase4');
    const nextPhaseBtn = document.getElementById('nextPhaseBtn');
    const typedMessage = document.getElementById('typedMessage');
    // Removed references to geminiApiButton and loadingIndicator


    const fullMessage = `Ojitos Verdes,

Mi Querida,
Hoy, 23 de junio, celebramos algo muy especial: tu cumplea√±os. Pero para m√≠, cada d√≠a contigo es una celebraci√≥n. Desde aquel 27 de enero en que te ped√≠ que caminaras conmigo en esta aventura llamada amor, mi vida cambi√≥ de una forma que no sab√≠a que necesitaba. Todo cobr√≥ m√°s sentido contigo.

Hoy, mientras celebras un a√±o m√°s de vida, quiero que sepas que cada momento a tu lado ha sido una bendici√≥n. Tu sonrisa ilumina mis d√≠as, tu dulzura me conquista una y otra vez, y esos ojitos verdes que me miran con amor... me tienen completamente enamorado.

En este d√≠a tan especial, quiero agradecerte por hacerme sentir tan especial, por tu paciencia infinita, tu cari√±o sincero y por ser simplemente t√∫. Y qu√© mejor momento para celebrar que justo despu√©s de haber terminado tu pr√°ctica hace unos d√≠as. Estoy tan orgulloso de ti y de todo lo que logras.

No s√© qu√© nos depara la vida, pero hay algo que tengo muy claro: mientras est√©s t√∫, todo estar√° bien. Lo que venga, lo enfrentaremos juntos, celebrando cada triunfo y apoy√°ndonos en cada desaf√≠o.

En tu cumplea√±os quiero recordarte que eres mi compa√±era, mi refugio, mi alegr√≠a y mi paz. Te amo desde hace estos meses hermosos... y te seguir√© amando mucho m√°s all√° del tiempo.

Feliz cumplea√±os, mi amor. Que este nuevo a√±o de vida est√© lleno de sue√±os cumplidos, sonrisas y momentos inolvidables juntos.

Feliz cumplea√±os mi ni√±a, mi amor. Siempre tuyo, ‚ù§Ô∏è`;

    function showPhase(phaseToShow) {
      document.querySelectorAll('.phase').forEach(p => {
        p.classList.remove('active');
        p.setAttribute('aria-hidden', 'true');
      });
      phaseToShow.classList.add('active');
      phaseToShow.setAttribute('aria-hidden', 'false');
    }

    // --- Fase 1 Logic ---
    function initPhase1Enhanced() {
      createEnhancedStars(phase1);
      createConstellations();
      createMagicParticles();
      initButton();
    }

    function createEnhancedStars(container) {
      const totalStars = 300;
      const starTypes = ['small', 'medium', 'large'];
      const starWeights = [0.7, 0.25, 0.05];

      for (let i = 0; i < totalStars; i++) {
        const star = document.createElement("div");
        const rand = Math.random();
        let starType = 'small';
        let cumulative = 0;
        for (let j = 0; j < starWeights.length; j++) {
          cumulative += starWeights[j];
          if (rand <= cumulative) {
            starType = starTypes[j];
            break;
          }
        }
        star.className = `star ${starType}`;
        star.style.left = Math.random() * 100 + "vw";
        star.style.top = Math.random() * 100 + "vh";
        star.style.animationDuration = (Math.random() * 3 + 2) + "s";
        star.style.animationDelay = Math.random() * 2 + "s";
        container.appendChild(star);
      }
    }

    function createConstellations() {
      const constellation = document.getElementById('constellation');
      const numLines = 12;

      for (let i = 0; i < numLines; i++) {
        const line = document.createElement('div');
        line.className = 'constellation-line';

        const startX = Math.random() * 80 + 10;
        const startY = Math.random() * 80 + 10;
        const length = Math.random() * 200 + 50;
        const angle = Math.random() * 360;

        line.style.left = startX + '%';
        line.style.top = startY + '%';
        line.style.width = length + 'px';
        line.style.transform = `rotate(${angle}deg)`;
        line.style.animationDelay = (i * 0.3 + Math.random() * 2) + 's';

        constellation.appendChild(line);
      }
    }

    function createMagicParticles() {
      const container = document.querySelector('.sunflower-container');
      const numParticles = 20;

      for (let i = 0; i < numParticles; i++) {
        setTimeout(() => {
          const particle = document.createElement('div');
          particle.className = 'magic-particle';

          const angle = (i * 360 / numParticles) * Math.PI / 180;
          const radius = 120 + Math.random() * 60;
          const x = Math.cos(angle) * radius;
          const y = Math.sin(angle) * radius;

          particle.style.left = `calc(50% + ${x}px)`;
          particle.style.top = `calc(50% + ${y}px)`;
          particle.style.animationDelay = Math.random() * 4 + 's';
          particle.style.animationDuration = (Math.random() * 2 + 3) + 's';

          container.appendChild(particle);
        }, i * 200 + 3000);
      }
    }

    function initButton() {
      const sparklesContainer = document.getElementById('buttonSparkles');

      sparkleInterval = setInterval(() => {
        if (currentPhase === 1) {
          const sparkle = document.createElement('div');
          sparkle.className = 'sparkle';
          sparkle.style.left = Math.random() * 100 + '%';
          sparkle.style.animationDelay = Math.random() * 0.5 + 's';
          sparklesContainer.appendChild(sparkle);

          setTimeout(() => {
            if (sparkle.parentNode) sparkle.parentNode.removeChild(sparkle);
          }, 2000);
        }
      }, 800);

      nextPhaseBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault();
        if (currentPhase === 1) {
          startTransitionToPhase2();
        }
      });
    }

    function startTransitionToPhase2() {
      if (currentPhase !== 1) return;

      clearInterval(sparkleInterval);

      phase1.style.transition = 'opacity 1s ease-out';
      phase1.style.opacity = '0';
      phase1.style.pointerEvents = 'none';

      setTimeout(() => {
        showPhase(phase2);
        phase2.style.transition = 'opacity 2s ease-in';
        currentPhase = 2;
        initPhase2();
      }, 1000);
    }

    document.addEventListener('click', function(e) {
      if (currentPhase === 1 && !e.target.closest('.magic-button')) {
        createClickEffect(e.clientX, e.clientY);
      }
    });

    function createClickEffect(x, y) {
      const effect = document.createElement('div');
      effect.className = 'magic-particle';
      effect.style.position = 'fixed';
      effect.style.left = x + 'px';
      effect.style.top = y + 'px';
      effect.style.transform = 'translate(-50%, -50%)';
      effect.style.zIndex = '60';
      effect.style.animation = 'magicFloat 2s ease-out forwards';
      document.body.appendChild(effect);

      setTimeout(() => {
        if (effect.parentNode) effect.parentNode.removeChild(effect);
      }, 2000);
    }

    // --- Fase 2 Logic ---
    function initPhase2() {
      phase2.innerHTML = ''; // Clear previous elements
      createEnhancedStars(phase2); // Add stars to phase 2 background

      const words = [
        "rubia hermosa", "ojitos bonitos", "mi cielo", "mi amor", "coraz√≥n",
        "luz de mi vida", "mi reina", "mi sol", "dulzura", "amor eterno",
        "mi princesa", "mi tesoro", "mi vida", "hermosa", "preciosa",
        "mi estrella", "mi √°ngel", "mi todo", "mi mundo", "bella",
        "mi ni√±a", "mi amorcito", "mi beb√©", "mi dulce", "mi cielo lindo",
        "mi amor bonito", "mi coraz√≥n", "mi adoraci√≥n", "mi diosa", "perfecta"
      ];

      const colors = [
        '#ff1493', '#00ffff', '#ff6b35', '#7fff00', '#da70d6', '#ffd700', '#ff69b4', '#00ff7f'
      ];

      for (let i = 0; i < 4; i++) {
        const interval = setInterval(() => {
          const wordDiv = document.createElement('div');
          wordDiv.classList.add('floating-word');
          const randomWord = words[Math.floor(Math.random() * words.length)];
          wordDiv.textContent = randomWord;
          const randomColor = colors[Math.floor(Math.random() * colors.length)];
          wordDiv.style.setProperty('--color', randomColor);
          wordDiv.style.left = (Math.random() * 70 + 15) + 'vw';
          wordDiv.style.top = (Math.random() * 70 + 15) + 'vh';
          phase2.appendChild(wordDiv);

          setTimeout(() => {
            if (phase2.contains(wordDiv)) {
              phase2.removeChild(wordDiv);
            }
          }, 5000);
        }, 1800);
        floatingWordsIntervals.push(interval); // Store interval ID
      }

      const shapeTypes = ['heart', 'star-shape', 'flower', 'butterfly', 'rose', 'diamond', 'crown', 'ring', 'kiss', 'cupid', 'sparkles', 'moon'];
      const shapeCount = 10;

      for (let i = 0; i < shapeCount; i++) {
        const shapeDiv = document.createElement('div');
        shapeDiv.classList.add('shape');
        const randomType = shapeTypes[Math.floor(Math.random() * shapeTypes.length)];
        shapeDiv.classList.add(randomType);

        shapeDiv.style.left = (Math.random() * 90 + 5) + 'vw';
        shapeDiv.style.top = (Math.random() * 90 + 5) + 'vh';
        shapeDiv.style.animationDuration = (Math.random() * 4 + 4) + 's';
        shapeDiv.style.animationDelay = (Math.random() * 3) + 's';

        phase2.appendChild(shapeDiv);
      }

      // After a certain time, transition to Phase 3
      setTimeout(() => {
        startTransitionToPhase3();
      }, 15000); // Transition to Phase 3 after 15 seconds of Phase 2
    }

    // --- Fase 3 & 4 Logic ---
    function startTransitionToPhase3() {
      if (currentPhase !== 2) return;

      // Clear intervals for Phase 2 floating elements
      floatingWordsIntervals.forEach(clearInterval);
      floatingWordsIntervals = []; // Reset array

      phase2.style.transition = 'opacity 1s ease-out';
      phase2.style.opacity = '0';
      phase2.style.pointerEvents = 'none';

      setTimeout(() => {
        showPhase(phase3);
        currentPhase = 3;
        // After showing Phase 3, transition to Phase 4
        setTimeout(() => {
          startTransitionToPhase4();
        }, 3000); // Show Phase 3 for 3 seconds
      }, 1000);
    }

    function startTransitionToPhase4() {
      if (currentPhase !== 3) return;

      phase3.style.transition = 'opacity 1s ease-out';
      phase3.style.opacity = '0';
      phase3.style.pointerEvents = 'none';

      setTimeout(() => {
        showPhase(phase4);
        currentPhase = 4;
        typeWriter(fullMessage); // Start typing effect for the message
      }, 1000);
    }

    // Typewriter effect function
    function typeWriter(message) {
      let i = 0;
      typedMessage.innerHTML = ''; // Clear content before typing
      const speed = 50; // Milliseconds per character

      function type() {
        if (i < message.length) {
          typedMessage.innerHTML += message.charAt(i);
          i++;
          setTimeout(type, speed);
        } else {
          // Remove blinking cursor after typing is complete
          typedMessage.style.borderRight = 'none';
        }
      }
      type();
    }

    document.addEventListener('DOMContentLoaded', () => {
      showPhase(phase1); // Start with Phase 1
      initPhase1Enhanced();
    });
  </script>
</body>
</html>
